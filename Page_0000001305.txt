OBJECT Page 1305 Mini Sales Invoice Subform
{
  OBJECT-PROPERTIES
  {
    Date=15/09/15;
    Time=12:00:00;
    Version List=NAVW19.00;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Lines;
               FRA=Lignes];
    MultipleNewLines=Yes;
    LinksAllowed=No;
    SourceTable=Table37;
    DelayedInsert=Yes;
    SourceTableView=WHERE(Document Type=FILTER(Invoice));
    PageType=ListPart;
    AutoSplitKey=Yes;
    OnNewRecord=BEGIN
                  Type := Type::Item;
                END;

    OnInsertRecord=BEGIN
                     Type := Type::Item;
                   END;

    OnDeleteRecord=BEGIN
                     DELETE;
                     MiniDocumentTotals.CalculateSalesHeaderTotals(TotalSalesHeader,VATAmount,Rec);
                     UpdatePage;
                   END;

    OnAfterGetCurrRecord=VAR
                           SalesLine@1000 : Record 37;
                         BEGIN
                           MiniDocumentTotals.CalculateSalesHeaderTotals(TotalSalesHeader,VATAmount,Rec);
                           UpdateEditableOnRow;

                           SalesLine.SETRANGE("Document Type","Document Type");
                           SalesLine.SETRANGE("Document No.","Document No.");
                           InvDiscAmountEditable := SalesLine.FINDFIRST AND CurrPage.EDITABLE;
                         END;

    ActionList=ACTIONS
    {
      { 1900000004;0 ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 1900206204;1 ;Action    ;
                      Name=InsertExtText;
                      AccessByPermission=TableData 279=R;
                      CaptionML=[ENU=Insert &Ext. Texts;
                                 FRA=Ins‚rer te&xtes ‚tendus];
                      ToolTipML=[ENU=Insert the extended item description that is set up for the item on the sales document line.;
                                 FRA=Ins‚rez la description plus longue qui est param‚tr‚e pour l'article sur la ligne document vente.];
                      Image=Text;
                      Scope=Repeater;
                      OnAction=BEGIN
                                 InsertExtendedText(TRUE);
                               END;
                                }
      { 1904522204;1 ;Action    ;
                      Name=Dimensions;
                      AccessByPermission=TableData 348=R;
                      ShortCutKey=Shift+Ctrl+D;
                      CaptionML=[ENU=Dimensions;
                                 FRA=Axes analytiques];
                      ToolTipML=[ENU=View or edit the dimension sets that are set up for the combination of customer and item on the sales document line.;
                                 FRA=Affichez ou modifiez les ensembles de dimensions qui sont configur‚s pour la combinaison client-article sur la ligne document vente.];
                      Image=Dimensions;
                      Scope=Repeater;
                      OnAction=BEGIN
                                 ShowDimensions;
                               END;
                                }
      { 13      ;1   ;Action    ;
                      Name=DeferralSchedule;
                      CaptionML=[ENU=Deferral Schedule;
                                 FRA=Tableau ‚chelonnement];
                      Enabled="Deferral Code" <> '';
                      Image=PaymentPeriod;
                      OnAction=BEGIN
                                 TotalSalesHeader.GET("Document Type","Document No.");
                                 ShowDeferrals(TotalSalesHeader."Posting Date",TotalSalesHeader."Currency Code");
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                GroupType=Repeater }

    { 4   ;2   ;Field     ;
                CaptionML=[ENU=Item No.;
                           FRA=Nø article];
                ToolTipML=[ENU=Specifies the number of the product that you want to sell. The product can be either an inventory item or a service. Choose the field to select an item card that represents the item or service.;
                           FRA=Indique le num‚ro du produit que vous souhaitez vendre. Le produit peut ˆtre un article en stock ou un service. Choisissez le champ pour s‚lectionner une fiche article qui repr‚sente l'article ou le service.];
                SourceExpr="No.";
                LookupPageID=Mini Item List;
                OnValidate=BEGIN
                             NoOnAfterValidate;
                             UpdateEditableOnRow;
                             UpdatePage;
                           END;

                ShowMandatory=TRUE }

    { 58  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies an item cross-reference number.;
                           FRA=Sp‚cifie le num‚ro de r‚f‚rence externe article.];
                SourceExpr="Cross-Reference No.";
                Visible=FALSE;
                OnValidate=BEGIN
                             CrossReferenceNoOnAfterValidat;
                           END;

                OnLookup=BEGIN
                           CrossReferenceNoLookUp;
                           InsertExtendedText(FALSE);
                         END;
                          }

    { 6   ;2   ;Field     ;
                CaptionML=[ENU=Description/Comment;
                           FRA=Description/Commentaire];
                ToolTipML=[ENU=Specifies the description of the product that you entered in the Item No. field. To add a message for the customer, enter text in the Description/Comment field on an empty line.;
                           FRA=Sp‚cifie la d‚signation du produit que vous avez entr‚ dans le champ Nø article. Pour ajouter un message pour le client, entrez le texte dans le champ Description/Commentaire, sur une ligne vide.];
                SourceExpr=Description;
                OnValidate=VAR
                             MiniLinesInstructionMgt@1000 : Codeunit 1320;
                           BEGIN
                             MiniLinesInstructionMgt.ShowCreateLineInstruction("No.");
                           END;
                            }

    { 8   ;2   ;Field     ;
                Width=8;
                ToolTipML=[ENU=Specifies how many units are being sold. This field affects the values in the Line Amount and Line Discount Amount fields and the Total fields at the bottom of the Lines FastTab.;
                           FRA=Sp‚cifie le nombre d'unit‚s vendues. Ce champ affecte les valeurs des champs Montant ligne et Montant remise ligne ainsi que des champs Total au bas du raccourci Lignes.];
                BlankZero=Yes;
                SourceExpr=Quantity;
                Enabled=RowEditable;
                Editable=RowEditable;
                OnValidate=BEGIN
                             UpdatePage;
                           END;

                ShowMandatory=TRUE }

    { 34  ;2   ;Field     ;
                Width=8;
                ToolTipML=[ENU=Specifies the unit of measure that is used to determine the value in the Unit Price field on the sales line. By default, the field is filled with the value in the Sales Unit of Measure field on the item card or the Base Unit of Measure field on the resource card.;
                           FRA=Sp‚cifie l'unit‚ de mesure utilis‚e pour d‚terminer la valeur dans le champ Prix unitaire de la ligne vente. Par d‚faut, le champ est renseign‚ avec la valeur du champ Unit‚ de vente de la fiche article ou le champ Unit‚ de base de la fiche ressource.];
                SourceExpr="Unit of Measure Code";
                Enabled=RowEditable;
                Editable=RowEditable;
                OnValidate=BEGIN
                             UpdatePage;
                           END;
                            }

    { 12  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the price for one unit on the sales line. By default, the field is filled with the value in the Unit Price field on the item or resource card.;
                           FRA=Sp‚cifie le prix d'une unit‚ de l'article vente. Par d‚faut, le champ contient la valeur figurant dans le champ Prix unitaire de la fiche article ou ressource.];
                BlankZero=Yes;
                SourceExpr="Unit Price";
                Enabled=RowEditable;
                Editable=RowEditable;
                OnValidate=BEGIN
                             UpdatePage;
                           END;

                ShowMandatory=TRUE }

    { 16  ;2   ;Field     ;
                Width=8;
                ToolTipML=[ENU=Contains the line discount percentage that is valid for the item quantity on the line.;
                           FRA=Indique le pourcentage de remise ligne valable pour la quantit‚ article de la ligne.];
                BlankZero=Yes;
                SourceExpr="Line Discount %";
                Enabled=RowEditable;
                Editable=RowEditable;
                OnValidate=BEGIN
                             UpdatePage;
                           END;
                            }

    { 40  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the amount of the discount that will be given on the invoice line. The program uses the Line Discount %, Quantity and Unit Price tables to calculate the amount.;
                           FRA=Indique le montant de la remise qui est accord‚e sur la ligne facture. Le programme utilise les tables % remise ligne, Quantit‚ et Prix unitaire pour calculer le montant.];
                SourceExpr="Line Discount Amount";
                Visible=FALSE;
                Enabled=RowEditable;
                Editable=false;
                OnValidate=BEGIN
                             UpdatePage;
                           END;
                            }

    { 42  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies whether the invoice line is included when the invoice discount is calculated.;
                           FRA=Indique si la ligne facture est incluse lors du calcul de la remise facture.];
                BlankZero=Yes;
                SourceExpr="Allow Invoice Disc.";
                Visible=FALSE;
                Enabled=RowEditable;
                Editable=RowEditable;
                OnValidate=BEGIN
                             UpdatePage;
                           END;
                            }

    { 64  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the amount of the sales line, calculated as the quantity times the unit price minus any percentage value in the Line Discount % field. If the Prices Including VAT check box on the customer card is selected, the amount includes VAT.;
                           FRA=Indique le montant de la ligne vente, calcul‚ comme ‚tant la quantit‚ multipli‚e par le prix unitaire moins toute valeur de pourcentage dans le champ % remise ligne. Si la case … cocher Prix TTC de la fiche client est activ‚e, le montant inclut la TVA.];
                BlankZero=Yes;
                SourceExpr="Line Amount";
                Enabled=RowEditable;
                Editable=RowEditable;
                OnValidate=BEGIN
                             UpdatePage;
                           END;
                            }

    { 80  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the invoice discount amount that is calculated on the line if you click Actions, point to Functions, and then click Calculate Invoice Discount. If you have placed a check mark in the Prices Including VAT field, the amount displayed include VATs.;
                           FRA=Indique le montant de la remise facture de la ligne qui est calcul‚ lorsque vous cliquez sur Actions, pointez sur Fonctions, puis cliquez sur Calculer remise facture. Si vous avez activ‚ le champ Prix TTC, le montant affich‚ inclut la TVA.];
                SourceExpr="Inv. Discount Amount";
                Visible=FALSE;
                Enabled=RowEditable;
                Editable=RowEditable;
                OnValidate=BEGIN
                             UpdatePage;
                           END;
                            }

    { 5   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of the job that the sales line is linked to. The field is filled in automatically by the program and cannot be changed.;
                           FRA=Indique le num‚ro de la tƒche … laquelle la ligne vente est li‚e. Le champ est renseign‚ automatiquement par le programme et ne peut pas ˆtre modifi‚.];
                SourceExpr="Job No." }

    { 10  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of the job task that the sales line is linked to. The field is filled in automatically by the program and cannot be changed.;
                           FRA=Indique le num‚ro de la tƒche … laquelle la ligne vente est li‚e. Le champ est renseign‚ automatiquement par le programme et ne peut pas ˆtre modifi‚.];
                SourceExpr="Job Task No." }

    { 9   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the entry number of the job planning line that the sales line is linked to. The field is filled in automatically by the program and cannot be changed.;
                           FRA=Indique le num‚ro d'‚criture de la ligne planning projet … laquelle la ligne vente est li‚e. Le champ est renseign‚ automatiquement par le programme et ne peut pas ˆtre modifi‚.];
                SourceExpr="Job Contract Entry No.";
                Visible=FALSE }

    { 11  ;2   ;Field     ;
                SourceExpr="Deferral Code";
                TableRelation="Deferral Template"."Deferral Code" }

    { 103 ;1   ;Group     ;
                GroupType=Group }

    { 106 ;2   ;Group     ;
                GroupType=Group }

    { 107 ;3   ;Field     ;
                Name=Invoice Discount Amount;
                CaptionML=[ENU=Invoice Discount Amount;
                           FRA=Montant remise facture];
                ToolTipML=[ENU=Specifies a discount amount that is deducted from the value in the Total Incl. VAT field. You can enter or change the amount manually. If you have set up invoice discounts, the specified percentage is shown in the Invoice Discount % field if the criteria are met. The calculated discount amount is then inserted in the Invoice Discount Amount field.;
                           FRA=Indique un montant de remise qui est d‚duit de la valeur indiqu‚e dans le champ Total TTC. Vous pouvez entrer ou modifier le montant manuellement. Si vous avez d‚fini des remises facture, le pourcentage sp‚cifi‚ est automatiquement affich‚ dans le champ Pourcentage de remise facture si les critŠres sont r‚unis. Le montant remise calcul‚ est alors ins‚r‚ dans le champ Montant remise facture.];
                SourceExpr=TotalSalesHeader."Invoice Discount Amount";
                AutoFormatType=1;
                AutoFormatExpr=TotalSalesHeader."Currency Code";
                Editable=InvDiscAmountEditable;
                OnValidate=VAR
                             SalesHeader@1000 : Record 36;
                           BEGIN
                             SalesHeader.GET("Document Type","Document No.");
                             MiniSalesCalcDiscByType.ApplyInvDiscBasedOnAmt(TotalSalesHeader."Invoice Discount Amount",SalesHeader);
                             CurrPage.UPDATE;
                           END;
                            }

    { 108 ;3   ;Field     ;
                Name=Cust. Invoice Disc. Pct.;
                CaptionML=[ENU=Customer Invoice Discount %;
                           FRA=% remise facture client];
                ToolTipML=[ENU=Specifies a discount percentage that is granted if the criteria are met that you have set up for invoice discounts. The calculated discount amount is inserted in the Invoice Discount Amount field, but you can change it manually.;
                           FRA=Indique un pourcentage de remise qui est accord‚ si les critŠres que vous avez param‚tr‚s pour les remises facture sont r‚unis. Le montant remise calcul‚ est ins‚r‚ dans le champ Montant remise facture, mais vous pouvez le modifier manuellement.];
                DecimalPlaces=0:1;
                SourceExpr=MiniSalesCalcDiscByType.GetCustInvoiceDiscountPct(Rec);
                Visible=TRUE;
                Editable=FALSE }

    { 131 ;2   ;Group     ;
                GroupType=Group }

    { 7   ;3   ;Field     ;
                Name=Total Amount Excl. VAT;
                DrillDown=No;
                CaptionML=[ENU=Total Amount Excl. VAT;
                           FRA=Montant total HT];
                ToolTipML=[ENU=Specifies the sum of the value in the Line Amount Excl. VAT field on all lines in the document minus any discount amount in the Invoice Discount Amount field. Note that amounts on document lines are shown with or without VAT depending on what you selected in the Prices Including VAT field on the customer or vendor card.;
                           FRA=Sp‚cifie la somme de la valeur du champ Montant ligne HT sur toutes les lignes du document, moins l'‚ventuel montant remise indiqu‚ dans le champ Montant remise facture. Notez que les montants sur les lignes de document sont affich‚s avec ou sans la TVA en fonction de ce que vous avez s‚lectionn‚ dans le champ Prix TTC de la fiche client ou fournisseur.];
                SourceExpr=TotalSalesHeader.Amount;
                AutoFormatType=1;
                AutoFormatExpr=TotalSalesHeader."Currency Code";
                CaptionClass=MiniDocumentTotals.GetTotalExclVATCaption(TotalSalesHeader."Currency Code");
                Editable=FALSE }

    { 2   ;3   ;Field     ;
                Name=Total VAT Amount;
                CaptionML=[ENU=Total VAT;
                           FRA=Total TVA];
                ToolTipML=[ENU=Specifies the sum of VAT amounts on all lines in the document. Note that amounts on document lines are shown with or without VAT depending on what you selected in the Prices Including VAT field on the customer or vendor card.;
                           FRA=Sp‚cifie la somme des montants de TVA sur toutes les lignes du document. Notez que les montants sur les lignes de document sont affich‚s avec ou sans la TVA en fonction de ce que vous avez s‚lectionn‚ dans le champ Prix TTC de la fiche client ou fournisseur.];
                SourceExpr=VATAmount;
                AutoFormatType=1;
                AutoFormatExpr=TotalSalesHeader."Currency Code";
                CaptionClass=MiniDocumentTotals.GetTotalVATCaption(TotalSalesHeader."Currency Code");
                Editable=FALSE }

    { 3   ;3   ;Field     ;
                Name=Total Amount Incl. VAT;
                CaptionML=[ENU=Total Amount Incl. VAT;
                           FRA=Montant total TTC];
                ToolTipML=[ENU=Specifies the sum of the value in the Line Amount Incl. VAT field on all lines in the document minus any discount amount in the Invoice Discount Amount field. Note that amounts on document lines are shown with or without VAT depending on what you selected in the Prices Including VAT field on the customer or vendor card.;
                           FRA=Sp‚cifie la somme de la valeur du champ Montant ligne TTC sur toutes les lignes du document, moins l'‚ventuel montant remise indiqu‚ dans le champ Montant remise facture. Notez que les montants sur les lignes de document sont affich‚s avec ou sans la TVA en fonction de ce que vous avez s‚lectionn‚ dans le champ Prix TTC de la fiche client ou fournisseur.];
                SourceExpr=TotalSalesHeader."Amount Including VAT";
                AutoFormatType=1;
                AutoFormatExpr=TotalSalesHeader."Currency Code";
                CaptionClass=MiniDocumentTotals.GetTotalInclVATCaption(TotalSalesHeader."Currency Code");
                Editable=FALSE;
                Style=Strong;
                StyleExpr=TRUE }

  }
  CODE
  {
    VAR
      TotalSalesHeader@1000 : Record 36;
      TransferExtendedText@1003 : Codeunit 378;
      MiniSalesCalcDiscByType@1001 : Codeunit 1300;
      MiniDocumentTotals@1002 : Codeunit 1301;
      VATAmount@1004 : Decimal;
      RowEditable@1005 : Boolean;
      JobRowEditable@1006 : Boolean;
      InvDiscAmountEditable@1007 : Boolean;

    LOCAL PROCEDURE InsertExtendedText@7(Unconditionally@1000 : Boolean);
    BEGIN
      IF TransferExtendedText.SalesCheckIfAnyExtText(Rec,Unconditionally) THEN BEGIN
        CurrPage.SAVERECORD;
        COMMIT;
        TransferExtendedText.InsertSalesExtText(Rec);
      END;
      IF TransferExtendedText.MakeUpdate THEN
        UpdatePage;
    END;

    LOCAL PROCEDURE UpdatePage@12();
    VAR
      SalesHeader@1001 : Record 36;
    BEGIN
      CurrPage.UPDATE;
      SalesHeader.GET("Document Type","Document No.");
      MiniSalesCalcDiscByType.ApplyDefaultInvoiceDiscount(TotalSalesHeader."Invoice Discount Amount",SalesHeader);
    END;

    LOCAL PROCEDURE NoOnAfterValidate@19066594();
    BEGIN
      InsertExtendedText(FALSE);
      TESTFIELD(Type,Type::Item);
    END;

    LOCAL PROCEDURE CrossReferenceNoOnAfterValidat@19048248();
    BEGIN
      InsertExtendedText(FALSE);
    END;

    LOCAL PROCEDURE UpdateEditableOnRow@5();
    BEGIN
      JobRowEditable := "Job No." = '';
      RowEditable := ("No." <> '') AND JobRowEditable;
    END;

    BEGIN
    END.
  }
}

